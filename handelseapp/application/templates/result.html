{% extends "base.html" %}

{% block title %}Resultat - Lönestatistik{% endblock %}

{% block content %}
<div class="container">
    <div class="sidebar">
        <h3>Ditt val</h3>
        <div class="selected-options">
            <p><strong>Yrke:</strong> <span id="selected-yrke"></span></p>
            <p><strong>Region:</strong> <span id="selected-region"></span></p>
        </div>
        
        <a href="/" style="display: block; text-align: center; padding: 10px; background: #28a745; color: white; text-decoration: none; border-radius: 5px; margin-top: 20px;">
            Ny sökning
        </a>

        <div id="result-statistics" style="margin-top: 20px;">
            <h4>Sammanfattning</h4>
            <div id="result-stats"></div>
        </div>
    </div>

    <div class="chart-area">
        <h3 id="result-title">Löneutveckling</h3>
        <div id="result-chart"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Hämta parametrar från URL
const urlParams = new URLSearchParams(window.location.search);
const yrke = urlParams.get('yrke') || 'Städare';
const region = urlParams.get('region') || 'Stockholm';

// Uppdatera gränssnittet
document.getElementById('selected-yrke').textContent = yrke;
document.getElementById('selected-region').textContent = region;
document.getElementById('result-title').textContent = `Löner för ${yrke} i ${region}`;

//Ersätt värdena med API-anrop!
const mockData = {
    'Städare': [28000, 29500, 31000, 32500, 34000],
    'Lärare': [32000, 33500, 35000, 36500, 38000],
    'Läkare': [35000, 37000, 39000, 41000, 43000],
    'DevOps': [45000, 47000, 49000, 51000, 53000]
};

// Visa resultat
function showResult() {
    const salaries = mockData[yrke] || [30000, 32000, 34000, 36000, 38000];
    const years = ['2020', '2021', '2022', '2023', '2024'];
    
    // Uppdatera diagram
    const chartData = [{
        x: years,
        y: salaries,
        type: 'lines+markers',
        name: yrke,
        line: {color: '#007bff', width: 3}
    }];

    Plotly.newPlot('result-chart', chartData, {
        title: `Löneutveckling för ${yrke} i ${region}`,
        xaxis: {title: 'År'},
        yaxis: {title: 'Lön (SEK)'}
    });

    // Uppdatera statistik
    const latest = salaries[4];
    const first = salaries[0];
    const change = ((latest - first) / first * 100).toFixed(1);
    
    document.getElementById('result-stats').innerHTML = `
        <p><strong>Senaste lön (2024):</strong><br>${latest.toLocaleString()} kr</p>
        <p><strong>Löneförändring:</strong><br>${change}%</p>
        <p><strong>Genomsnitt:</strong><br>${Math.round(salaries.reduce((a,b) => a+b) / salaries.length).toLocaleString()} kr</p>
    `;
}

showResult();
</script>
{% endblock %}